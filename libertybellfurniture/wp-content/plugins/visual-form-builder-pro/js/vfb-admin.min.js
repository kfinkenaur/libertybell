jQuery(document).ready(function(e){function n(){e("#vfb-form-meta-preview iframe").attr("src",e("#vfb-form-meta-preview iframe").attr("src"))}function s(t){if("FIELDSET"!==t)e("#vfb-fieldset-first-warning").show();else e("#vfb-fieldset-first-warning").hide()}function u(){o=true}function v(t){var n="";e.ajax(ajaxurl,{async:false,data:{action:"visual_form_builder_export_entries_count",id:t,page:pagenow}}).done(function(t){if(t>1e3){e("#vfb-export-entries-rows").empty();var r=Math.ceil(parseInt(t)/1e3);for(var i=1;i<=r;i++){e("#vfb-export-entries-rows").append(e("<option></option>").attr("value",i).text(i))}e("#vfb-export-entries-pages").show()}else{e("#vfb-export-entries-pages").hide()}n=t}).fail(function(e){});return n}if(window.VfbAdminPages){var t=VfbAdminPages.vfb_pages;if(pagenow==t["vfb-pro"]){e(".if-js-closed").removeClass("if-js-closed").addClass("closed");postboxes.add_postbox_toggles(t["vfb-pro"]);columns.useCheckboxesForHidden();columns.checked=function(t){e(".vfb-item-"+t).removeClass("hidden-field")};columns.unchecked=function(t){e(".vfb-item-"+t).addClass("hidden-field")};e(".hide-column-tog").not(":checked").each(function(){e("#vfb-menu-to-edit").find(".vfb-item-"+e(this).val()).addClass("hidden-field")})}e(document).on("change",t["vfb-pro"]+' .columns-prefs [type="radio"]',function(){if(3==e(this).val()){var t=e("#vfb-form-meta-preview iframe").contents().height();e("#vfb-form-meta-preview iframe").css({height:t})}})}e(function(){function r(){for(var e=0,r=t.length;e<r;e++){t[e].style.height=n+t[e].contentWindow.document.body.offsetHeight+"px"}}var t=e("#vfb-form-meta-preview iframe"),n=20;t.load(function(){this.style.height=n+this.contentWindow.document.body.offsetHeight+"px"})});e("select#switcher_form").change(function(){var t=window.location.href,n=e("option:selected",this).val(),r=t.replace(new RegExp(/(\d+)$/g),"")+n;window.location=r});var r=null;e(document).on("mouseenter mouseleave",".vfb-tooltip",function(t){if(t.type=="mouseenter"){if(r){clearTimeout(r);r=null}var n=e(this).attr("title"),i=e(this).attr("rel"),s=e(this).width();e(this).append('<div class="vfb-tooltip-popup"><h3>'+n+"</h3><p>"+i+"</p></div>");e.data(this,"title",n);this.title="";e(this).find(".vfb-tooltip-popup").css({left:s+22});r=setTimeout(function(){e(".vfb-tooltip-popup").fadeIn(300)},500)}else{this.title=e.data(this,"title");e(".vfb-tooltip-popup").fadeOut(500);e(this).children().remove()}});e(".vfb-color-picker").each(function(){var t=e(this),n=t.attr("id"),r=e("#"+n);r.wpColorPicker({change:function(e,t){r.css("background-color",t.color.toString())},clear:function(){r.css("background-color","")}})});e(".color:input").focus(function(){var t=e(this).attr("id"),n=t.replace(/vfb-/,"");e("#picker-"+n).show()}).blur(function(){var t=e(this).attr("id"),n=t.replace(/vfb-/,"");e("#picker-"+n).hide()});e(".email-design-default").click(function(t){t.preventDefault();var n=e(this),r=n.attr("id"),i=r.replace(/default/,""),s=n.text(),o;o=n.hasClass("text-black")?"black":"white";if(s==e("#vfb"+i).val())o="";e("#vfb"+i).val(s).css({"background-color":s,color:o})});e(document).on("change",".vfb-hidden-option",function(t){var n=e(this).attr("id").match(new RegExp(/(\d+)$/g),"");if(e(this).val()=="custom"){e("#static-var-"+n).show();e("#edit-form-item-staticvar-"+n).val("").prop("disabled",false)}else{e("#static-var-"+n).hide();e("#edit-form-item-staticvar-"+n).prop("disabled","disabled")}});e(document).on("change",".vfb-options-other",function(t){var n=e(this).attr("id").match(new RegExp(/(\d+)$/g),"");if(e(this).is(":checked")){e("#options-other-"+n).show();e("#options-other-"+n+" :input").prop("disabled",false)}else{e("#options-other-"+n).hide();e("#options-other-"+n+" :input").prop("disabled",true)}});e(document).on("click","a.vfb-add-option",function(t){t.preventDefault();var n=e(this).parent().siblings(".vfb-cloned-options"),r=n.children(),i=r.length,s=i+1,o=r[i-1],u=e(o).attr("id"),a=e(o).children("label").attr("for");var f=a.replace(new RegExp(/(\d+)$/g),""),l=u.replace(new RegExp(/(\d+)$/g),"");var c=e("#"+u).clone().attr("id",l+s);c.children("label").attr("for",f+s);c.find('input[type="text"]').attr("id",f+s);c.find('input[type="radio"]').attr("value",s);e("#"+l+i).after(c)});e(document).on("click","a.vfb-delete-option",function(t){t.preventDefault();var n=e(this).parent().parent().find(".vfb-cloned-option").length;if(n-1==0){alert("You must have at least one option.")}else{e(this).closest("div").remove()}});e(".vfb-cloned-options").sortable({items:"div.vfb-option",handle:".vfb-interface-sort"});e(document).on("click","a.addEmail",function(t){t.preventDefault();var n=e(this).closest("#email-details").find(".vfb-cloned-option").length;var r=n+1;var i=e(this).closest("div").attr("id");var s=e(this).closest("div").find("label").attr("for");var o=s.replace(new RegExp(/(\d+)$/g),"");var u=i.replace(new RegExp(/(\d+)$/g),"");var a=e("#"+i).clone().attr("id",u+r);a.find("label").attr("for",o+r);a.find("input").attr("id",o+r);e("#"+u+n).after(a)});e(document).on("click","a.deleteEmail",function(t){t.preventDefault();var n=e(this).closest("#email-details").find(".vfb-cloned-option").length;if(n-1==0){alert("You must have at least one option.")}else{e(this).closest("div").remove()}});e('.option input[type="radio"]').mousedown(function(){e(this).attr("previousValue",e(this).prop("checked"))}).click(function(){var t=e(this).attr("previousValue");if(t=="true")e(this).prop("checked",false)});e(document).on("click","a.item-edit",function(t){t.preventDefault();e(t.target).closest("li").children(".menu-item-settings").slideToggle("fast");e(this).toggleClass("opened");var n=e(t.target).closest("dl");if(n.hasClass("vfb-menu-item-inactive")){n.removeClass("vfb-menu-item-inactive").addClass("vfb-menu-item-active")}else{n.removeClass("vfb-menu-item-active").addClass("vfb-menu-item-inactive")}});e("a.vfb-bulking").click(function(t){t.preventDefault();e("#choicesText").val("")});e(document).on("click","a.vfb-bulk-options",function(t){t.preventDefault();var n=[];e(this).parent().find("li").each(function(t){n.push(e(this).text())});e("#choicesText").val(n.join("\n"))});e(document).on("submit","#vfb_bulk_add_options",function(t){t.preventDefault();var n="#form-item-settings-"+e("#bulk-add-field-id").val(),r=e(n+" .vfb-cloned-options"),s=r.children(),o=s.length,u=s[o-1],a=e(u).attr("id"),f=e(u).children("label").attr("for");var l=e("#choicesText").val(),c=l.split("\n"),h=o+1,p=f.replace(new RegExp(/(\d+)$/g),""),d=a.replace(new RegExp(/(\d+)$/g),""),v=[];for(i=0;i<c.length;++i){v[i]=e("#"+a).clone().attr("id",d+h);v[i].children("label").attr("for",p+h);v[i].find('input[type="text"]').attr("id",p+h);v[i].find('input[type="text"]').attr("value",c[i]);v[i].find('input[type="radio"]').attr("value",h);h++}e("#"+a).after(v);window.tb_remove()});e("#vfb-main").sortable({placeholder:"vfb-sortable-placeholder",items:"div.form-boxes:not(.ui-state-disabled)",stop:function(t,n){e.post(ajaxurl,{action:"visual_form_builder_form_order",order:e(this).sortable("toArray")})}});e("#form-items .vfb-draggable-form-items").draggable({connectToSortable:"#vfb-menu-to-edit",helper:function(){var t='<dl class="menu-item-bar ui-draggable"><dt class="vfb-menu-item-handle"><span class="item-title">'+e(this).text()+"</span></dt></dl>";return t},distance:2,zIndex:5,cursorAt:{top:20},containment:"document"});e("#vfb-menu-to-edit").nestedSortable({listType:"ul",maxLevels:3,handle:".vfb-menu-item-handle",placeholder:"vfb-sortable-placeholder",forcePlaceholderSize:true,forceHelperSize:true,tolerance:"pointer",toleranceElement:"> dl",items:"li:not(.ui-state-disabled)",create:function(t,n){e(this).css("min-height",e(this).height())},start:function(t,n){if(!e(n.item).hasClass("vfb-draggable-form-items"))n.placeholder.height(n.item.height())},stop:function(t,r){var i=e("#vfb-menu-to-edit .item-type:first").text();if(r.item.hasClass("ui-draggable")){r.item.hide();var o=e("#form-items").serializeArray(),a=r.item.text(),f=$previous=$next="",l=r.item;if(l.closest("li.form-item").size()>0)f=l.closest("li.form-item").attr("id").match(new RegExp(/(\d+)$/g))[0];if(l.prev().size()>0)$previous=l.prev().attr("id").match(new RegExp(/(\d+)$/g))[0];opts={url:ajaxurl,type:"POST",async:true,cache:false,dataType:"html",data:{action:"visual_form_builder_create_field",order:e(this).nestedSortable("toArray"),data:o,field_type:a,page:pagenow,parent:f,previous:$previous,nonce:e("#_wpnonce").val()},success:function(t){e("#loading-animation").hide();var r=e(t),i=r.closest("li.form-item").attr("id");r.hide().insertBefore(l);e("#"+i).fadeIn();l.remove();if(r.prev().hasClass("ui-state-disabled"))r.hide().insertBefore("#vfb-menu-to-edit li.ui-state-disabled:first").fadeIn();n();return}}}else{opts={url:ajaxurl,type:"POST",async:true,cache:false,data:{action:"visual_form_builder_sort_field",order:e(this).nestedSortable("toArray")},success:function(t){e("#loading-animation").hide();s(i);n();return}}}e.ajax(opts);u()}});e("#form-items .vfb-draggable-form-items").click(function(t){t.preventDefault();e(this).data("submit_value",e(this).text())});e("#form-items .vfb-draggable-form-items").click(function(t){t.preventDefault();var r=e(this).closest("form").serializeArray(),i=e(this).data("submit_value"),s=e("#vfb-menu-to-edit li.ui-state-disabled:first").attr("id").match(new RegExp(/(\d+)$/g))[0];e("img.waiting").show();e.post(ajaxurl,{action:"visual_form_builder_create_field",data:r,field_type:i,previous:s,page:pagenow,nonce:e("#_wpnonce").val()}).done(function(t){e("img.waiting").hide();e(t).hide().insertBefore("#vfb-menu-to-edit li.ui-state-disabled:first").fadeIn();n()})});e(document).on("click","a.item-delete",function(t){t.preventDefault();var r=childs=new Array,i=0,s=e(this).attr("href"),o=s.split("&"),u=confirm("You are about to permanently delete this field.\n'Cancel' to stop, 'OK' to delete.");if(!u)return false;for(var a=0;a<o.length;a++){var f=o[a].indexOf("=");var l=o[a].substring(0,f);var c=o[a].substring(f+1);r[l]=c}var h=e(this).closest(".form-item").find("ul").children();var p=h.parent().html();h.each(function(t){childs[t]=e(this).attr("id").match(new RegExp(/(\d+)$/g))[0]});var d=e(this).closest("li.form-item").parents("li.form-item");if(d.length)i=d.attr("id").match(new RegExp(/(\d+)$/g))[0];e.post(ajaxurl,{action:"visual_form_builder_delete_field",form:r["form"],field:r["field"],child_ids:childs,parent_id:i,page:pagenow,nonce:r["_wpnonce"]}).done(function(t){e("#form_item_"+r["field"]).addClass("deleting").animate({opacity:0,height:0},350,function(){e(this).before(p).remove()});n()})});e(document).on("click","a.vfb-duplicate-field",function(t){t.preventDefault();var r=new Array,i=e(this).attr("href"),s=i.split("&");for(var o=0;o<s.length;o++){var u=s[o].indexOf("=");var a=s[o].substring(0,u);var f=s[o].substring(u+1);r[a]=f}e("img.waiting").show();e.post(ajaxurl,{action:"visual_form_builder_duplicate_field",form:r["form"],field:r["field"],page:pagenow,nonce:r["_wpnonce"]}).done(function(t){e("img.waiting").hide();var i=e(t).closest("li.form-item").attr("id");e(t).hide().insertAfter("#form_item_"+r["field"]);e("#"+i).fadeIn();n()})});e(document).on("change","#vfb-email-rule-setting",function(t){e("#vfb-build-email-rules-container").toggle(e(this).prop("checked"))});e(document).on("click","a.vfb-add-email-rule",function(t){t.preventDefault();var n=e(this).parent(),r=n.find("select");num=e(this).parent().parent().find(".vfb-email-rules-data").length,newNum=num+1,newElem=n.clone();newElem.find('input[type="text"]').each(function(e,t){this.name=this.name.replace(/\[(\d+)\]/,"["+num+"]")});newElem.find("select").each(function(t,n){this.name=this.name.replace(/\[(\d+)\]/,"["+num+"]");e(n).val(r.eq(t).val())});e(n).after(newElem)});e(document).on("click","a.vfb-delete-email-rule",function(t){t.preventDefault();var n=e(this).closest("#vfb-build-email-rules-container").find(".vfb-email-rules-data").length;if(n-1==0)alert("You must have at least one rule.");else{e(this).closest("div").remove();var r=e("#vfb-build-email-rules-container").find(".vfb-email-rules-data");r.each(function(t){e(this).find("select").each(function(){e(this).attr("name").replace(/\[(\d+)\]/,"["+t+"]")});e(this).find('input[type="text"]').attr("name").replace(/\[(\d+)\]/,"["+n+"]")})}});e(document).on("submit","#vfb-add-email-rules",function(t){t.preventDefault();var n=e(this).closest("form").serialize();e("#vfb-saving-email-rule img").show();e("#vfb-saving-email-rule-error").html("");e.post(ajaxurl,{action:"visual_form_builder_email_rules_save",data:n,page:pagenow}).done(function(t){e("#vfb-saving-email-rule img").hide();if(t)e("#vfb-saving-email-rule-error").html(t)})});e(document).on("click",".vfb-show-field-rules",function(t){t.preventDefault();e(this).parent().hide();e("#vfb-build-conditional-fields-container").show()});e(document).on("change","#vfb-conditional-setting",function(t){e("#vfb-build-conditional-fields-container").toggle(e(this).prop("checked"))});e(document).on("change",".vfb-conditional-other-fields",function(t){var n=e(this).val(),r=e(this).parent().children(".vfb-conditional-other-fields-options");e.post(ajaxurl,{action:"visual_form_builder_conditional_fields_options",field_id:n,page:pagenow}).done(function(e){r.empty().append(e)})});e(document).on("click","a.vfb-add-condition",function(t){t.preventDefault();var n=e(this).parent(),r=n.find("select"),i=e(this).parent().parent().find(".vfb-conditional-fields-data").length,s=i+1,o=n.clone();o.find("select").each(function(t,n){this.name=this.name.replace(/\[(\d+)\]/,"["+i+"]");e(n).val(r.eq(t).val())});e(n).after(o)});e(document).on("click","a.vfb-delete-condition",function(t){t.preventDefault();var n=e(this).closest("#vfb-build-conditional-fields-container").find(".vfb-conditional-fields-data").length;if(n-1==0)alert("You must have at least one rule.");else{e(this).closest("div").remove();var r=e("#vfb-build-conditional-fields-container").find(".vfb-conditional-fields-data");r.each(function(t){e(this).find("select").each(function(){e(this).attr("name").replace(/\[(\d+)\]/,"["+t+"]")})})}});e(document).on("submit","#vfb-add-conditional-fields",function(t){t.preventDefault();var n=e(this).closest("form").serialize();e("#vfb-saving-conditional img").show();e("#vfb-saving-conditonal-error").html("");e.post(ajaxurl,{action:"visual_form_builder_conditional_fields_save",data:n,page:pagenow}).done(function(t){e("#vfb-saving-conditional img").hide();if(t)e("#vfb-saving-conditonal-error").html(t)})});e("#form-settings-button").click(function(t){t.preventDefault();e(this).toggleClass("current");e("#form-settings").slideToggle("fast");var n=e('input[name="form_id"]').val(),r=e(this).hasClass("current")?"opened":"closed";e.post(ajaxurl,{action:"visual_form_builder_form_settings",form:n,status:r,page:pagenow}).done(function(t){if(r=="closed"){e(".settings-links").removeClass("on");e(".settings-links:first").addClass("on");e(".form-details").slideUp("fast");e(".form-details:first").show("fast")}})});e(".settings-links").click(function(t){t.preventDefault();e(".settings-links").removeClass("on");e(".form-details").slideUp("fast");if(e(this).next("div").is(":hidden")==true){e(this).addClass("on");e(this).next().slideDown("fast")}var n=e('input[name="form_id"]').val(),r=this.hash.replace(/#/g,"");e.post(ajaxurl,{action:"visual_form_builder_form_settings",form:n,accordion:r,page:pagenow})});var o=false;e("#vfb-form-builder-management input, #vfb-form-builder-management select, #vfb-form-builder-management textarea").change(function(){u()});window.onbeforeunload=function(){if(o)return"The changes you made will be lost if you navigate away from this page."};e(document).on("submit","#visual-form-builder-update",function(){window.onbeforeunload=null});if(e(".columns-2 #side-sortables, .columns-3 #side-sortables").length>0){var a=e("#vfb_form_items_meta_box"),f=a.width(),l=a.offset(),c=a.nextAll(),h=false;e(window).on("scroll",function(){if(e(window).scrollTop()>l.top){a.stop().css({top:55,position:"fixed","z-index":"1",width:f});if(c.is(":visible")){h=true;c.stop().css({opacity:.1})}}else{a.stop().css({top:0,position:"relative"});if(h){c.stop().css({opacity:1})}}})}var p=e(".form-success-type:checked").val();switch(p){case"text":case"display-entry":e("#form-success-message-text").show();break;default:e("#form-success-message-"+p).show();break}e(".form-success-type").change(function(){var t=e(this).val();switch(t){case"text":case"display-entry":e("#form-success-message-text").show();e("#form-success-message-page, #form-success-message-redirect").hide();break;case"page":e("#form-success-message-page").show();e("#form-success-message-text, #form-success-message-redirect").hide();break;case"redirect":e("#form-success-message-redirect").show();e("#form-success-message-text, #form-success-message-page").hide();break}});e(".vfb-field-types").click(function(t){t.preventDefault();e("#vfb-field-tabs li").removeClass("tabs");e(this).parent().addClass("tabs");e(".tabs-panel-active").removeClass("tabs-panel-active").addClass("tabs-panel-inactive");var n=this.hash;e(n).removeClass("tabs-panel-inactive").addClass("tabs-panel-active")});e("#visual-form-builder-update").validate({rules:{"form_email_to[]":{email:true},form_email_from:{email:true},form_success_message_redirect:{url:true},form_notification_email_name:{required:function(t){return e("#form-notification-setting").is(":checked")}},form_notification_email_from:{required:function(t){return e("#form-notification-setting").is(":checked")},email:true},form_notification_email:{required:function(t){return e("#form-notification-setting").is(":checked")}},form_entries_allowed:{digits:true}},messages:{form_entries_allowed:"Please enter only digits or leave blank for unlimited entries."},errorClass:"vfb-error",errorPlacement:function(e,t){e.insertAfter(t.parent())}});e("#visual-form-builder-new-form").validate({errorClass:"vfb-error"});e("#form-entries-schedule-start").datetimepicker({controlType:"select",showTime:false});e("#form-entries-schedule-end").datetimepicker({controlType:"select",showTime:false});e("#form_email_from_name_override").change(function(){if(e("#form_email_from_name_override").val()==""){e("#form-email-sender-name").prop("readonly",false)}else{e("#form-email-sender-name").prop("readonly","readonly")}});e("#form_email_from_override").change(function(){if(e("#form_email_from_override").val()==""){e("#form-email-sender").prop("readonly",false)}else{e("#form-email-sender").prop("readonly","readonly")}});e("#notification-email").toggle(e("#form-notification-setting").prop("checked"));e("#form-notification-setting").change(function(){var t=e(this).is(":checked");if(t){e("#notification-email").show();e("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").prop("disabled",false)}else{e("#notification-email").hide();e("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").prop("disabled","disabled")}});e("#paypal-setup").toggle(e("#form-paypal-setting").prop("checked"));e("#form-paypal-setting").change(function(){var t=e(this).is(":checked");if(t){e("#paypal-setup").show();e("#form-paypal-email, #form-paypal-currency, #form-paypal-shipping, #form-paypal-tax, #form-paypal-field-price").prop("disabled",false)}else{e("#paypal-setup").hide();e("#form-paypal-email, #form-paypal-currency, #form-paypal-shipping, #form-paypal-tax, #form-paypal-field-price").prop("disabled","disabled")}});if(e("#form-paypal-field-price").val()!==""){e(".assigned-price").show()}else{e(".assigned-price").hide()}e("#form-paypal-field-price").change(function(){var t=e(this).val();e("#paypal-price-switch").show();e.get(ajaxurl,{action:"visual_form_builder_paypal_price",form_id:e('input[name="form_id"]').val(),field_id:t}).done(function(t){e(".assigned-price").show().html(t);e("#paypal-price-switch").hide()})});var d=e("#vfb-export").find(".vfb-export-filters");e("#vfb-export").find("input:radio").change(function(){d.slideUp("fast");switch(e(this).val()){case"forms":e("#forms-filters").slideDown();break;case"entries":e("#entries-filters").slideDown();break}});e("#vfb-export-select-all").click(function(t){t.preventDefault();e('#vfb-export-entries-fields input[type="checkbox"]').prop("checked",true)});e("#vfb-export-unselect-all").click(function(t){t.preventDefault();e('#vfb-export-entries-fields input[type="checkbox"]').prop("checked",false)});e("#vfb-export-entries-forms").change(function(){var t=e(this).val(),n=v(t);e("#vfb-export-entries-fields").html("Loading...");e.get(ajaxurl,{action:"visual_form_builder_export_load_options",id:t,count:n,page:pagenow}).done(function(t){e("#vfb-export-entries-fields").html(t)}).fail(function(t){e("#vfb-export-entries-fields").html("Error loading entry fields.")})});e("#vfb-export-entries-rows").change(function(){var t=e("#vfb-export-entries-forms").val();var n=e(this).val();e("#vfb-export-entries-fields").html("Loading...");e.get(ajaxurl,{action:"visual_form_builder_export_load_options",id:t,offset:n,page:pagenow}).done(function(t){e("#vfb-export-entries-fields").html(t)}).fail(function(t){e("#vfb-export-entries-fields").html("Error loading entry fields.")})})})